<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Planner | Planexa</title>
  <script src="/js/auth-helper.js"></script>
  <meta name="description" content="Planner app with To‑Do, Reminders, Goals, and Events" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <link rel="stylesheet" href="./css/styles.css?v=role1" />
  <script>
    // APPLY THEME IMMEDIATELY
    (function () {
      const savedTheme = localStorage.getItem('planner.theme');
      if (savedTheme) {
        const theme = JSON.parse(savedTheme);
        const root = document.documentElement;
        Object.keys(theme).forEach(key => {
          root.style.setProperty(key, theme[key]);
        });
      }
    })();
  </script>
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ctext y='24' font-size='24'%3E%F0%9F%97%93%EF%B8%8F%3C/text%3E%3C/svg%3E" />
  <style>
    /* Hide weekly checkboxes in Goals */
    #tab-goals [aria-label="Weekly checks"] {
      display: none !important;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .tab-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      color: #4b5563;
      transition: all 0.2s;
    }

    .tab-btn:hover {
      background-color: #f3f4f6;
    }

    .tab-btn.active {
      background-color: #e0f2fe;
      color: #0369a1;
      font-weight: 500;
    }

    /* Profile Dropdown Styles */
    #profile-dropdown.show {
      transform: scale(100%);
      opacity: 1;
      pointer-events: auto;
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: 0.75rem;
      text-decoration: none;
      color: #374151;
      transition: all 0.2s;
    }

    .dropdown-item:hover {
      background-color: #f9fafb;
    }

    /* Caps class for heading */
    .caps {
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
  </style>
</head>

<body>
  <header class="sticky top-0 z-10 header-dark">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center gap-4">
      <a href="./landing.html" class="flex items-center gap-3">
        <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center">
          <i data-lucide="rocket" class="w-6 h-6 text-white"></i>
        </div>
        <span
          class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600">Planexa</span>
      </a>
      <nav class="ml-auto">
        <ul class="flex gap-2 items-center" id="tabs">
          <li><a href="#todo" data-tab="todo" class="tab-btn">To‑Do</a></li>
          <li><a href="#shopping" data-tab="shopping" class="tab-btn">Shopping</a></li>
          <li><a href="#reminders" data-tab="reminders" class="tab-btn">Reminders</a></li>
          <li><a href="#goals" data-tab="goals" class="tab-btn">Goals</a></li>
          <li><a href="#calendar" data-tab="calendar" class="tab-btn">Events</a></li>
          <li>
            <a href="#messages" data-tab="messages"
              class="tab-btn relative inline-flex items-center justify-center p-2 rounded-lg">
              <i data-lucide="message-square" class="w-5 h-5"></i>
              <span id="chat-notif-dot"
                class="absolute top-1 right-1 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white hidden"></span>
            </a>
          </li>
          <!-- Notifications -->

          <li class="ml-2">
            <a href="#notifications" data-tab="notifications"
              class="tab-btn relative inline-flex items-center justify-center p-2 rounded-lg">
              <i data-lucide="bell" class="w-5 h-5"></i>
              <span id="notif-badge"
                class="absolute top-0 right-0 bg-red-500 text-white text-[10px] rounded-full min-w-[16px] h-4 flex items-center justify-center px-1 font-bold leading-none"
                style="display:none;"></span>
            </a>
          </li>
          <!-- Profile Button & Dropdown -->
          <li class="relative ml-2" id="profile-dropdown-container">
            <button id="profile-btn"
              class="flex items-center gap-2 px-3 py-2 rounded-xl bg-indigo-50 text-indigo-700 hover:bg-indigo-100 transition-all border border-indigo-100 shadow-sm">
              <div class="w-8 h-8 rounded-lg bg-indigo-600 flex items-center justify-center text-white shadow-sm">
                <i data-lucide="user" class="w-5 h-5"></i>
              </div>
              <span class="font-bold text-sm hidden sm:block">Profile</span>
              <i data-lucide="chevron-down" id="profile-chevron"
                class="w-4 h-4 text-indigo-400 transition-transform"></i>
            </button>

            <!-- Dropdown Menu -->
            <div id="profile-dropdown"
              class="absolute right-0 mt-2 w-56 bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-gray-100 overflow-hidden transform scale-95 opacity-0 pointer-events-none transition-all duration-200 z-50 origin-top-right">
              <div class="p-3 space-y-1">
                <a href="#profile" data-tab="profile"
                  class="dropdown-item flex items-center gap-3 p-3 rounded-xl hover:bg-indigo-50 transition-all group">
                  <div class="p-2 bg-indigo-50 rounded-lg text-indigo-600 group-hover:bg-indigo-100 transition-colors">
                    <i data-lucide="line-chart" class="w-4 h-4"></i>
                  </div>
                  <span class="font-medium text-gray-800 text-sm">Analytics</span>
                </a>
                <a href="account.html"
                  class="dropdown-item flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-all group">
                  <div class="p-2 bg-gray-50 rounded-lg text-gray-600 group-hover:bg-gray-100 transition-colors">
                    <i data-lucide="settings" class="w-4 h-4"></i>
                  </div>
                  <span class="font-medium text-gray-800 text-sm">Account Settings</span>
                </a>
                <a href="#" id="dropdown-review-btn"
                  class="dropdown-item flex items-center gap-3 p-3 rounded-xl hover:bg-yellow-50 transition-all group">
                  <div class="p-2 bg-yellow-50 rounded-lg text-yellow-600 group-hover:bg-yellow-100 transition-colors">
                    <i data-lucide="star" class="w-4 h-4"></i>
                  </div>
                  <span class="font-medium text-gray-800 text-sm">Review Coach</span>
                </a>
                <a href="customization.html"
                  class="dropdown-item flex items-center gap-3 p-3 rounded-xl hover:bg-purple-50 transition-all group">
                  <div class="p-2 bg-purple-50 rounded-lg text-purple-600 group-hover:bg-purple-100 transition-colors">
                    <i data-lucide="palette" class="w-4 h-4"></i>
                  </div>
                  <span class="font-medium text-gray-800 text-sm">Customization</span>
                </a>
                <div class="border-t border-gray-100 my-1"></div>
                <button id="dropdown-logout-btn"
                  class="w-full flex items-center gap-3 p-3 rounded-xl hover:bg-red-50 text-red-600 transition-all group">
                  <div class="p-2 bg-red-50 rounded-lg text-red-600 group-hover:bg-red-100 transition-colors">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                  </div>
                  <span class="font-medium text-sm">Log Out</span>
                </button>
              </div>
            </div>
          </li>
        </ul>
      </nav>

    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6">
    <!-- To‑Do Tab -->
    <section id="tab-todo" class="tab-panel">
      <!-- Standardized Top Spacing -->
      <div class="pt-4"></div>
      <div class="card shadow-2xl rounded-3xl border-0 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div class="grid gap-3 sm:grid-cols-5 sm:items-end p-2">
          <div class="sm:col-span-2">
            <label class="label font-bold text-indigo-900" for="todo-input">New task</label>
            <input id="todo-input"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              type="text" placeholder="e.g., Buy groceries" />
          </div>
          <div>
            <label class="label font-bold text-indigo-900" for="todo-importance">Importance</label>
            <select id="todo-importance"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12">
              <option value="important" selected>Important</option>
              <option value="not_important">Not Important</option>
            </select>
          </div>
          <div>
            <label class="label font-bold text-indigo-900" for="todo-urgency">Urgency</label>
            <select id="todo-urgency"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12">
              <option value="urgent" selected>Urgent</option>
              <option value="not_urgent">Not Urgent</option>
            </select>
          </div>
          <div class="sm:text-right">
            <label class="label" style="opacity:0">Add</label>
            <button id="todo-add"
              class="btn btn-primary w-full sm:w-auto h-12 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition-all font-bold">Add
              Task</button>
          </div>
        </div>
      </div>

      <!-- Eisenhower Matrix -->
      <div class="mt-4 matrix">
        <div class="matrix-col do">
          <div class="matrix-header">DO IT<br /><span class="muted">Urgent • Important</span></div>
          <ul id="todo-list-do" class="space-y-2"></ul>
        </div>
        <div class="matrix-col schedule">
          <div class="matrix-header">SCHEDULE IT<br /><span class="muted">Not Urgent • Important</span></div>
          <ul id="todo-list-schedule" class="space-y-2"></ul>
        </div>
        <div class="matrix-col delegate">
          <div class="matrix-header">DELEGATE IT<br /><span class="muted">Urgent • Not Important</span></div>
          <ul id="todo-list-delegate" class="space-y-2"></ul>
        </div>
        <div class="matrix-col delete">
          <div class="matrix-header">DEFER IT<br /><span class="muted">Not Urgent • Not Important</span></div>
          <ul id="todo-list-delete" class="space-y-2"></ul>
        </div>
      </div>
    </section>

    <!-- Shopping Tab -->
    <section id="tab-shopping" class="tab-panel">
      <div class="pt-4"></div>
      <div class="card shadow-2xl rounded-3xl border-0 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div class="grid gap-3 sm:grid-cols-5 sm:items-end p-2">
          <div class="sm:col-span-4">
            <label class="label font-bold text-indigo-900" for="shop-input">What do we need to buy?</label>
            <input id="shop-input"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              type="text" placeholder="e.g., Milk, Eggs, Bread..." />
          </div>
          <div class="sm:text-right">
            <label class="label" style="opacity:0">Add</label>
            <button id="shop-add"
              class="btn btn-primary w-full sm:w-auto h-12 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition-all font-bold">Add
              to List</button>
          </div>
        </div>
      </div>

      <!-- Notepad UI -->
      <div class="notepad-container">
        <div class="notepad-paper">
          <h3 class="text-3xl font-bold text-indigo-900 mb-8 font-serif italic border-b-2 border-indigo-100 pb-2">
            Shopping List</h3>
          <ul id="shop-list" class="space-y-0 text-gray-800"></ul>
        </div>
      </div>
    </section>

    <!-- Reminders Tab -->
    <section id="tab-reminders" class="tab-panel">
      <div class="pt-4"></div>
      <div class="card shadow-2xl rounded-3xl border-0 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div class="grid gap-3 sm:grid-cols-5 sm:items-end p-2">
          <div class="sm:col-span-2">
            <label class="label font-bold text-indigo-900" for="rem-title">Reminder</label>
            <input id="rem-title"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              type="text" placeholder="e.g., Call the dentist" />
          </div>
          <div class="sm:col-span-2">
            <label class="label font-bold text-indigo-900" for="rem-datetime">Date & time</label>
            <input id="rem-datetime"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              type="datetime-local" />
          </div>
          <div class="sm:text-right">
            <label class="label" style="opacity:0">Add</label>
            <button id="rem-add"
              class="btn btn-primary w-full sm:w-auto h-12 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition-all font-bold">Add
              Reminder</button>
          </div>
        </div>
      </div>
      <div class="mt-6 bg-white rounded-3xl shadow-xl border border-slate-100 p-6">
        <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
          <i data-lucide="list" class="w-5 h-5 text-indigo-500"></i>
          My Reminders
        </h3>
        <ul id="rem-list" class="space-y-2"></ul>

        <!-- Empty State Placeholder (Visible when list is empty) -->
        <div id="rem-empty-state" class="text-center py-8 hidden">
          <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-3">
            <i data-lucide="bell-off" class="w-8 h-8 text-slate-300"></i>
          </div>
          <p class="text-slate-400 font-medium">No reminders yet</p>
        </div>
      </div>
    </section>

    <!-- Goals Tab -->
    <section id="tab-goals" class="tab-panel">
      <div class="pt-4"></div>
      <div class="card shadow-2xl rounded-3xl border-0 bg-gradient-to-r from-indigo-50 to-purple-50">
        <div class="grid gap-3 sm:grid-cols-5 sm:items-end p-2">
          <div class="sm:col-span-2">
            <label class="label font-bold text-indigo-900" for="goal-title">Goal</label>
            <input id="goal-title"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              type="text" placeholder="e.g., Learn React" />
          </div>
          <div>
            <label class="label font-bold text-indigo-900" for="goal-category">Category</label>
            <select id="goal-category"
              class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
              required>
              <option value="" disabled selected>Choose</option>
              <option value="Physical">Physical</option>
              <option value="Financial">Financial</option>
              <option value="Career">Career</option>
              <option value="Social">Social</option>
              <option value="Spiritual">Spiritual</option>
              <option value="Personal Development">Personal Development</option>
              <option value="Relationships">Relationships</option>
            </select>
          </div>
          <div class="flex gap-2">
            <div class="flex-1">
              <label class="label font-bold text-indigo-900" for="goal-total">Total (hrs)</label>
              <input id="goal-total"
                class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
                type="number" min="0" step="0.1" placeholder="40" />
            </div>
            <div class="flex-1">
              <label class="label font-bold text-indigo-900" for="goal-spent">Spent (hrs)</label>
              <input id="goal-spent"
                class="input bg-white/80 backdrop-blur-sm border-2 border-indigo-100 focus:border-indigo-500 rounded-2xl h-12"
                type="number" min="0" step="0.1" placeholder="5" />
            </div>
          </div>
          <div class="sm:text-right">
            <label class="label" style="opacity:0">Add</label>
            <button id="goal-add"
              class="btn btn-primary w-full sm:w-auto h-12 rounded-2xl bg-gradient-to-r from-indigo-600 to-purple-600 shadow-lg shadow-indigo-200 hover:shadow-indigo-300 transition-all font-bold">Add
              Goal</button>
          </div>
        </div>
      </div>
      <ul id="goal-list" class="mt-4 space-y-2"></ul>
    </section>

    <!-- Events Tab (Calendar) -->
    <section id="tab-calendar" class="tab-panel">
      <div class="pt-4"></div>
      <!-- Calendar Container with Premium Styling -->
      <div class="calendar-container">
        <!-- Calendar Header -->
        <div class="calendar-header">
          <div class="calendar-nav">
            <button id="cal-prev" class="calendar-nav-btn">
              <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>
            <span id="cal-label" class="calendar-title">November 2023</span>
            <button id="cal-next" class="calendar-nav-btn">
              <i data-lucide="chevron-right" class="w-5 h-5"></i>
            </button>
          </div>
          <div class="calendar-actions">
            <button id="add-birthday-btn" class="btn-today bg-blue-100 text-blue-700 hover:bg-blue-200 border-blue-200">
              <i data-lucide="cake" class="w-4 h-4 inline-block mr-1"></i> Add Birthday
            </button>
            <button id="add-event-btn" class="btn-add">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Add Event
            </button>
          </div>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-days-grid">
          <!-- Weekday Headers -->
          <div class="weekday">SUN</div>
          <div class="weekday">MON</div>
          <div class="weekday">TUE</div>
          <div class="weekday">WED</div>
          <div class="weekday">THU</div>
          <div class="weekday">FRI</div>
          <div class="weekday">SAT</div>

          <!-- Calendar Days (populated by JavaScript) -->
          <div id="calendar-days-content" style="display: contents;">
            <!-- Days will be populated by JavaScript -->
          </div>
        </div>
      </div>
      <div id="selected-day-tasks" class="mt-6"></div>
    </section>

    <!-- Messages Tab -->
    <section id="tab-messages" class="tab-panel">
      <div class="pt-4"></div>
      <div
        class="h-[calc(100vh-12rem)] glass-card rounded-[2.5rem] border border-slate-100 overflow-hidden shadow-2xl shadow-slate-200/50 flex">
        <div class="w-80 border-r border-slate-100 flex flex-col bg-slate-50/50 text-slate-800">
          <div class="p-6 border-b border-slate-100 bg-white/80 backdrop-blur-md sticky top-0 z-10">
            <h3 class="text-xl font-black text-slate-800 tracking-tight flex items-center gap-2">
              <i data-lucide="user" class="w-5 h-5 text-indigo-600"></i> Coach
            </h3>
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Your coach conversation</p>
          </div>

          <div class="flex-1 overflow-y-auto custom-scrollbar p-2">
            <button id="coach-chat-item" type="button"
              class="w-full flex items-center gap-4 p-4 rounded-2xl bg-white/80 hover:bg-white transition-all border border-slate-100 shadow-sm text-left">
              <div id="chat-coach-img"
                class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-black text-lg shadow-lg shadow-indigo-200 overflow-hidden">
              </div>
              <div class="min-w-0">
                <div id="chat-coach-name" class="font-black text-slate-800 tracking-tight truncate">Your Coach</div>
                <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Tap to open</div>
              </div>
            </button>
          </div>
        </div>

        <div class="flex-1 flex flex-col bg-white relative">
          <div
            class="p-6 border-b border-slate-100 flex items-center justify-between bg-white/80 backdrop-blur-md sticky top-0 z-10">
            <div class="flex items-center gap-4">
              <div class="relative">
                <div id="messages-coach-avatar"
                  class="w-12 h-12 rounded-2xl bg-indigo-500 flex items-center justify-center text-white font-black text-lg shadow-lg shadow-indigo-200 overflow-hidden">
                </div>
                <div
                  class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white bg-green-500 shadow-sm">
                </div>
              </div>
              <div>
                <h3 class="text-lg font-black text-slate-800 tracking-tight" id="messages-coach-name">Your Coach</h3>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Online</p>
              </div>
            </div>
          </div>

          <div id="chat-messages" class="flex-1 overflow-y-auto p-8 space-y-6 custom-scrollbar bg-slate-50/20">
            <div id="chat-welcome" class="h-full flex flex-col items-center justify-center text-center space-y-4">
              <div
                class="w-20 h-20 bg-indigo-50 text-indigo-200 rounded-[2rem] flex items-center justify-center shadow-inner">
                <i data-lucide="message-circle" class="w-10 h-10"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold text-slate-800">Your Communication Hub</h3>
                <p class="text-slate-500 max-w-xs mt-2 text-sm font-semibold">Message your coach and stay on track.</p>
              </div>
            </div>
          </div>

          <div class="p-6 border-t border-slate-100 bg-white">
            <form id="chat-form"
              class="flex gap-4 items-center bg-slate-50 p-3 rounded-[1.5rem] border border-slate-200 focus-within:border-indigo-300 focus-within:ring-4 focus-within:ring-indigo-500/5 transition-all">
              <input id="chat-input" type="text" autocomplete="off" placeholder="Type your message..."
                class="flex-1 bg-transparent border-none py-2 px-4 text-sm text-slate-800 focus:ring-0 outline-none font-medium">
              <button type="submit" id="chat-send-btn"
                class="p-3 bg-indigo-600 text-white rounded-2xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 active:scale-95"
                disabled>
                <i data-lucide="send-horizontal" class="w-5 h-5"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Event List (For Mobile) -->
    <div id="event-list" class="mt-6 space-y-3 md:hidden">
      <!-- Events will be populated by JavaScript -->
    </div>

    <!-- Edit Goal Modal -->
    <!-- Edit Goal Modal -->
    <div id="edit-goal-modal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300">
      <div
        class="bg-white rounded-2xl p-8 w-full max-w-sm mx-4 shadow-2xl transform transition-all scale-100 border border-white/20">
        <div class="flex justify-between items-center mb-6">
          <div>
            <h3 class="text-2xl font-bold text-gray-800">Update Progress</h3>
            <p class="text-sm text-gray-500 mt-1" id="edit-goal-subtitle">Keep going!</p>
          </div>
          <button id="close-goal-modal"
            class="p-2 -mr-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <form id="edit-goal-form" class="space-y-6">
          <input type="hidden" id="edit-goal-id">
          <div>
            <label for="edit-goal-spent" class="block text-sm font-bold text-gray-700 mb-2">Time Spent (hours)</label>
            <div class="relative">
              <input type="number" id="edit-goal-spent" required min="0" step="0.1"
                class="w-full px-4 py-4 border border-gray-200 rounded-xl focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all text-xl font-semibold text-gray-800 placeholder:font-normal"
                placeholder="0.0">
              <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-medium">hrs</span>
            </div>
            <p class="text-xs text-right mt-2 text-gray-500" id="edit-goal-limit-hint">Total Goal: 0 hrs</p>
          </div>
          <div class="flex gap-3">
            <button type="button" id="cancel-goal-edit"
              class="flex-1 px-4 py-3 text-sm font-semibold text-gray-700 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all shadow-sm">
              Cancel
            </button>
            <button type="submit"
              class="flex-1 px-4 py-3 text-sm font-bold text-white bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl hover:from-blue-700 hover:to-indigo-700 shadow-lg hover:shadow-indigo-500/25 transition-all transform hover:-translate-y-0.5">
              Save Update
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Event Modal -->
    <div id="event-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold" id="event-modal-title">Add Event</h3>
          <button id="close-event-modal" class="text-gray-500 hover:text-gray-700">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <form id="event-form" class="space-y-4">
          <input type="hidden" id="event-id" value="">
          <div>
            <label for="event-title" class="block text-sm font-medium text-gray-700 mb-1">Event Title</label>
            <input type="text" id="event-title" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Enter event title">
          </div>
          <div>
            <label for="event-date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
            <input type="date" id="event-date" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <input type="hidden" id="event-time" value="12:00">
          <div>
            <label for="event-description" class="block text-sm font-medium text-gray-700 mb-1">Description
              (Optional)</label>
            <textarea id="event-description" rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Add details about your event"></textarea>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" id="cancel-event"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Cancel
            </button>
            <button type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Save
            </button>
          </div>
        </form>
      </div>
      <!-- Task Limit Warning Modal -->
      <div id="limit-warning-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm mx-4 shadow-2xl transform transition-all scale-100">
          <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-orange-100 mb-4">
              <i data-lucide="alert-triangle" class="h-6 w-6 text-orange-600"></i>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Too Many Tasks</h3>
            <p class="text-sm text-gray-500 mb-6">
              You've added many tasks today. Are you sure you want to add more?
            </p>
            <div class="flex justify-center gap-3">
              <button id="limit-cancel-btn"
                class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-200">
                Cancel
              </button>
              <button id="limit-proceed-btn"
                class="px-4 py-2 text-sm font-medium text-white bg-orange-600 rounded-lg hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 shadow-sm">
                Proceed
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Birthday Modal -->
    <div id="birthday-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-semibold text-blue-800 flex items-center gap-2">
            <i data-lucide="cake" class="w-6 h-6 text-blue-500"></i> Add Birthday
          </h3>
          <button id="close-birthday-modal" class="text-gray-500 hover:text-gray-700">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        <form id="birthday-form" class="space-y-4">
          <div>
            <label for="bday-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
            <input type="text" id="bday-name" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
              placeholder="Whose birthday is it?">
          </div>
          <div class="grid grid-cols-3 gap-3">
            <div>
              <label for="bday-day" class="block text-sm font-medium text-gray-700 mb-1">Day</label>
              <input type="number" id="bday-day" required min="1" max="31"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                placeholder="DD">
            </div>
            <div>
              <label for="bday-month" class="block text-sm font-medium text-gray-700 mb-1">Month</label>
              <select id="bday-month" required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="1">Jan</option>
                <option value="2">Feb</option>
                <option value="3">Mar</option>
                <option value="4">Apr</option>
                <option value="5">May</option>
                <option value="6">Jun</option>
                <option value="7">Jul</option>
                <option value="8">Aug</option>
                <option value="9">Sep</option>
                <option value="10">Oct</option>
                <option value="11">Nov</option>
                <option value="12">Dec</option>
              </select>
            </div>
            <div>
              <label for="bday-year" class="block text-sm font-medium text-gray-700 mb-1">Year</label>
              <input type="number" id="bday-year" required min="1900" max="2100"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                placeholder="YYYY">
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-2">
            <button type="button" id="cancel-birthday"
              class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Cancel
            </button>
            <button type="submit"
              class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
              Save Birthday
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Notifications Tab -->
    <section id="tab-notifications" class="tab-panel p-4">
      <div class="pt-4"></div>
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-semibold">Notifications</h2>
        <button id="mark-all-read-btn" class="px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200">
          Mark All as Read
        </button>
      </div>

      <div id="notifications-list" class="space-y-3">
        <!-- Notifications will be loaded here -->
        <div class="text-center text-gray-500 py-8">
          <i data-lucide="bell-off" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
          <p>No notifications yet</p>
        </div>
      </div>
    </section>

    <!-- Review Coach Tab -->
    <section id="tab-review" class="tab-panel">
      <div class="w-full">
        <div class="flex items-center justify-between mb-8">
          <h2 class="text-2xl font-bold text-gray-800">Review Your Coach</h2>
          <button onclick="window.history.back()"
            class="px-6 py-3 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2">
            <i data-lucide="arrow-left" class="w-5 h-5"></i>
            Back
          </button>
        </div>

        <div id="coach-review-card"
          class="bg-gradient-to-br from-indigo-50 to-purple-50 p-8 rounded-2xl border-2 border-indigo-200 shadow-xl">
          <div id="review-coach-info" class="flex items-center gap-6 mb-8 p-6 bg-white rounded-2xl shadow-md">
            <div id="review-coach-photo"
              class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center text-white font-bold text-2xl shadow-lg">
              C
            </div>
            <div>
              <div id="review-coach-name" class="text-2xl font-bold text-indigo-900 mb-1">Coach Name</div>
              <div id="review-coach-type" class="text-sm text-indigo-600 font-medium">Business Coach</div>
            </div>
          </div>
          <form id="coach-review-form" class="space-y-6">
            <div>
              <label class="block text-lg font-semibold text-gray-800 mb-4">How would you rate your
                experience?</label>
              <div class="flex gap-3 justify-center" id="star-rating">
                <button type="button" data-star="1"
                  class="star-btn text-gray-300 hover:text-yellow-400 transition-all transform hover:scale-110">
                  <i data-lucide="star" class="w-12 h-12"></i>
                </button>
                <button type="button" data-star="2"
                  class="star-btn text-gray-300 hover:text-yellow-400 transition-all transform hover:scale-110">
                  <i data-lucide="star" class="w-12 h-12"></i>
                </button>
                <button type="button" data-star="3"
                  class="star-btn text-gray-300 hover:text-yellow-400 transition-all transform hover:scale-110">
                  <i data-lucide="star" class="w-12 h-12"></i>
                </button>
                <button type="button" data-star="4"
                  class="star-btn text-gray-300 hover:text-yellow-400 transition-all transform hover:scale-110">
                  <i data-lucide="star" class="w-12 h-12"></i>
                </button>
                <button type="button" data-star="5"
                  class="star-btn text-gray-300 hover:text-yellow-400 transition-all transform hover:scale-110">
                  <i data-lucide="star" class="w-12 h-12"></i>
                </button>
              </div>
              <input type="hidden" name="rating" id="review-rating-input" required>
            </div>
            <div>
              <label for="review-comment" class="block text-lg font-semibold text-gray-800 mb-3">Share your
                experience</label>
              <textarea id="review-comment" rows="6"
                class="w-full px-6 py-4 text-base rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all placeholder:text-gray-400"
                placeholder="Tell us about your coaching experience..."></textarea>
            </div>
            <button type="submit"
              class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 px-6 text-lg rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02]">
              Submit Review
            </button>
          </form>
        </div>
      </div>
    </section>

    <!-- Profile & Settings Tab -->
    <section id="tab-profile" class="tab-panel">
      <div class="pt-4"></div>
      <div class="card">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Profile & Settings</h2>
        <!-- QUICK STATS -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <!-- STAT CARD -->
          <div class="bg-slate-50 rounded-xl p-5 border border-gray-100 hover:shadow-md transition">
            <div class="text-gray-500 text-sm font-medium">Tasks Completed</div>
            <div class="text-3xl font-bold text-gray-900 mt-1" id="tasks-completed">0</div>
            <div class="h-1.5 bg-gray-200 rounded-full mt-3 overflow-hidden">
              <div class="h-full bg-green-500 rounded-full" id="bar-tasks-completed" style="width: 75%"></div>
            </div>
          </div>

          <div class="bg-slate-50 rounded-xl p-5 border border-gray-100 hover:shadow-md transition">
            <div class="text-gray-500 text-sm font-medium">Goals in Progress</div>
            <div class="text-3xl font-bold text-gray-900 mt-1" id="goals-in-progress">0</div>
            <div class="h-1.5 bg-gray-200 rounded-full mt-3 overflow-hidden">
              <div class="h-full bg-blue-500 rounded-full" id="bar-goals-progress" style="width: 40%"></div>
            </div>
          </div>

          <div class="bg-slate-50 rounded-xl p-5 border border-gray-100 hover:shadow-md transition">
            <div class="text-gray-500 text-sm font-medium">Productivity</div>
            <div class="text-3xl font-bold text-gray-900 mt-1" id="productivity-score">0%</div>
            <div class="h-1.5 bg-gray-200 rounded-full mt-3 overflow-hidden">
              <div class="h-full bg-purple-500 rounded-full" id="bar-productivity" style="width: 65%"></div>
            </div>
          </div>

          <div class="bg-slate-50 rounded-xl p-5 border border-gray-100 hover:shadow-md transition">
            <div class="text-gray-500 text-sm font-medium">Streak</div>
            <div class="text-3xl font-bold text-gray-900 mt-1" id="login-streak">0 days</div>
            <div class="text-xs text-gray-500 mt-1 font-medium">Current streak</div>
          </div>
        </div>

        <!-- CHARTS -->
        <div class="mt-8 grid gap-6 md:grid-cols-2">

          <!-- TASK COMPLETION CHART -->
          <div class="bg-slate-50 p-6 rounded-xl border border-gray-100">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Productivity Overview</h3>
            <div class="relative h-64 w-full">
              <canvas id="task-completion-chart"></canvas>
            </div>
          </div>

          <!-- GOAL PROGRESS -->
          <div class="bg-slate-50 p-6 rounded-xl border border-gray-100">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Goal Progress</h3>
            <div class="space-y-4" id="goal-progress-container">
            </div>
          </div>
        </div>

      </div>

    </section>

  </main>

  <script>
    const profileBtn = document.getElementById("profile-btn");
    const profileDropdown = document.getElementById("profile-dropdown");
    const profileChevron = document.getElementById("profile-chevron");
    const dropdownLogoutBtn = document.getElementById("dropdown-logout-btn");
    const dropdownReviewBtn = document.getElementById("dropdown-review-btn");

    function toggleProfileDropdown(e) {
      if (e) e.stopPropagation();
      const isShowing = profileDropdown.classList.contains("show");

      if (isShowing) {
        profileDropdown.classList.remove("show");
        profileChevron.style.transform = "rotate(0deg)";
      } else {
        profileDropdown.classList.add("show");
        profileChevron.style.transform = "rotate(180deg)";
      }
    }

    // Toggle on Chevron or Name or Icon click
    profileBtn.addEventListener("click", (e) => {
      // If we clicked the chevron specifically, just toggle
      if (e.target.closest('#profile-chevron')) {
        toggleProfileDropdown(e);
      } else {
        // Navigate to profile/analytics and toggle the menu
        window.location.hash = 'profile';
        toggleProfileDropdown(e);
      }
    });

    // Close dropdown on outside click
    window.addEventListener("click", (e) => {
      if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileDropdown.classList.remove("show");
        profileChevron.style.transform = "rotate(0deg)";
      }
    });

    // Close dropdown when a dropdown item is clicked
    document.querySelectorAll('.dropdown-item').forEach(item => {
      item.addEventListener('click', () => {
        profileDropdown.classList.remove("show");
        profileChevron.style.transform = "rotate(0deg)";
      });
    });

    // Logout Logic
    async function handleLogout(e) {
      e.preventDefault();
      try {
        await fetch('/api/logout', { method: 'POST', credentials: 'include' });
        localStorage.removeItem('planner.theme');
        localStorage.removeItem('planner.themeId');
        localStorage.removeItem('planner.user');
        window.location.replace('landing.html');
      } catch (error) {
        console.error('Logout failed:', error);
        localStorage.removeItem('planner.theme');
        localStorage.removeItem('planner.themeId');
        localStorage.removeItem('planner.user');
        window.location.replace('landing.html');
      }
    }

    if (dropdownLogoutBtn) {
      dropdownLogoutBtn.addEventListener('click', handleLogout);
    }

    // Review Coach Logic
    if (dropdownReviewBtn) {
      dropdownReviewBtn.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.hash = 'review';
      });
    }
  </script>
  <script>
    // Redundant manual auth guard replaced by auth-helper.js

    // Removed back-button trapping to allow browser Back to leave the app

    function initTabs() {
      const tabButtons = document.querySelectorAll('.tab-btn');

      function activateTab(tabId) {
        // Update active tab button
        tabButtons.forEach(btn => {
          if (btn.getAttribute('data-tab') === tabId) {
            btn.classList.add('active');
          } else {
            btn.classList.remove('active');
          }
        });

        // Show the corresponding tab panel
        document.querySelectorAll('.tab-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        const panel = document.getElementById(`tab-${tabId}`);
        if (panel) panel.classList.add('active');
      }

      // Attach listeners first
      tabButtons.forEach(button => {
        button.addEventListener('click', function (e) {
          const tabId = this.getAttribute('data-tab');
          if (tabId) {
            e.preventDefault();
            // Set hash to trigger hashchange listener
            window.location.hash = tabId;
          }
        });
      });

      // Activate initial tab based on hash or default to first
      const initialHash = (window.location.hash || '').replace('#', '');
      const defaultTab = document.querySelector('#tabs .tab-btn')?.getAttribute('data-tab') || 'todo';
      activateTab(initialHash || defaultTab);

      // Keep panels in sync if hash changes (e.g., deep links)
      window.addEventListener('hashchange', () => {
        const h = (window.location.hash || '').replace('#', '');
        if (h) activateTab(h);
      });
    }

    if (document.readyState !== 'loading') {
      initTabs();
    } else {
      document.addEventListener('DOMContentLoaded', initTabs);
    }
  </script>
  <footer class="max-w-7xl mx-auto px-4 py-8 text-center text-sm text-slate-500">
    <script>
      // Show footer only on main page
      if (window.location.pathname.endsWith("index.html")) {
        document.write(`
      <p>Copyright © 2025 - Designed & Powered by 
        <a href="https://purplehuetechnosoft.com" target="_blank" rel="noopener" style="color:#845ec2;text-decoration:underline;font-weight:600;">Purple Hue Technosoft Pvt. Ltd.</a>
      </p>
    `);
      }
    </script>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script src="./js/ui.js?v=db2"></script>
  <script src="./js/calendar.js"></script>
  <script src="./js/notifications.js"></script>
  <script src="./js/chat.js"></script>
  <!-- Push Notification Registration -->

  <script>
    const VAPID_PUBLIC_KEY = 'BDp9g81H4VcPyHz9MbyXV29BERLt4SN4cwgaze-rAHf2iRmuIxJok6LeXmu3oBzAFBaeSFubZZ8jeprCSBAj2KY';

    // Convert VAPID key
    function urlBase64ToUint8Array(base64String) {
      const padding = '='.repeat((4 - base64String.length % 4) % 4);
      const base64 = (base64String + padding).replace(/-/g, '+').replace(/_/g, '/');
      const rawData = window.atob(base64);
      const outputArray = new Uint8Array(rawData.length);
      for (let i = 0; i < rawData.length; ++i) {
        outputArray[i] = rawData.charCodeAt(i);
      }
      return outputArray;
    }

    // Register service worker and subscribe to push
    async function initPushNotifications() {
      try {
        // Check if service workers are supported
        if (!('serviceWorker' in navigator)) {
          console.log('Service workers not supported');
          return;
        }

        // Register service worker
        const registration = await navigator.serviceWorker.register('/sw.js');
        console.log('✓ Service Worker registered');

        // Request notification permission
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          console.log('Notification permission denied');
          return;
        }

        console.log('✓ Notification permission granted');

        // Subscribe to push notifications
        const subscription = await registration.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
        });

        // Send subscription to server (using session auth, no token needed)
        const response = await fetch('/api/push/subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include', // Include session cookie
          body: JSON.stringify(subscription)
        });

        if (response.ok) {
          console.log('✓ Push notifications enabled');
        } else {
          const error = await response.json();
          console.error('Failed to subscribe:', error);
        }
      } catch (error) {
        console.error('Push notification setup error:', error);
      }
    }


    // Initialize push notifications when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPushNotifications);
    } else {
      initPushNotifications();
    }
  </script>
</body>

</html>