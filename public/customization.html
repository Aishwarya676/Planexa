<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Customization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="./css/styles.css?v=role1">
    <script src="/js/auth-helper.js"></script>
    <style>
        body {
            background-color: var(--site-bg, #AFC1D6);
            color: #0f172a;
            font-family: 'Inter', system-ui, sans-serif;
            margin: 0;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .btn-brand {
            background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            color: white;
            transition: all 0.2s;
        }

        .btn-brand:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        /* Theme Preview Circles */
        .theme-option {
            width: 70px;
            height: 70px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: 3px solid transparent;
        }

        .theme-option:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .theme-option.active {
            border-color: #6366f1;
            transform: scale(1.05);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .check-icon {
            color: white;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .theme-option.active .check-icon {
            opacity: 1;
        }
    </style>
    <script>
        // APPLY THEME IMMEDIATELY
        (function () {
            const savedTheme = localStorage.getItem('planner.theme');
            if (savedTheme) {
                const theme = JSON.parse(savedTheme);
                const root = document.documentElement;
                Object.keys(theme).forEach(key => {
                    root.style.setProperty(key, theme[key]);
                });
            }
        })();
    </script>
</head>

<body class="min-h-screen">

    <header class="py-6">
        <div class="max-w-4xl mx-auto px-6">
            <a href="app.html#profile"
                class="inline-flex items-center gap-2 px-5 py-2.5 bg-white/50 backdrop-blur-md rounded-xl text-slate-600 hover:text-indigo-600 border border-white/60 shadow-sm transition-all font-bold text-sm">
                <i data-lucide="arrow-left" class="w-4 h-4"></i>
                <span>Back to Dashboard</span>
            </a>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-6 pb-12">
        <div class="glass-card rounded-3xl p-8 md:p-12">
            <div class="flex flex-col md:flex-row items-center gap-6 mb-12 border-b border-slate-200/50 pb-8">
                <div
                    class="w-20 h-20 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-200">
                    <i data-lucide="palette" class="w-10 h-10 text-white"></i>
                </div>
                <div class="text-center md:text-left">
                    <h1 class="text-3xl font-extrabold text-slate-900 tracking-tight">Customization</h1>
                    <p class="text-slate-500 font-medium">Personalize your experience with a custom theme.</p>
                </div>
            </div>

            <div class="space-y-8">
                <div class="bg-white/50 rounded-3xl p-8 border border-white/60">
                    <div class="mb-8">
                        <h3 class="text-sm font-bold text-indigo-500 uppercase tracking-widest mb-1">Theme Selection
                        </h3>
                        <p class="text-slate-400 text-sm font-medium">Choose a color scheme that suits your style</p>
                    </div>

                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8 justify-items-center"
                        id="theme-grid">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="flex justify-end pt-4">
                    <button id="save-theme-btn"
                        class="px-10 py-4 btn-brand rounded-2xl font-bold text-sm uppercase tracking-widest shadow-lg shadow-indigo-100">
                        Apply Theme
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const themes = [
                {
                    id: 'default',
                    name: 'Purple',
                    colors: {
                        '--brand': '#845ec2',
                        '--site-bg': '#AFC1D6',
                        '--btn-bg': '#845ec2',
                        '--header-bg': '#e0f4fd'
                    },
                    previewColor: '#845ec2'
                },
                {
                    id: 'ocean',
                    name: 'Ocean',
                    colors: {
                        '--brand': '#0081C9',
                        '--site-bg': '#e0f2fe',
                        '--btn-bg': '#0081C9',
                        '--header-bg': '#f0f9ff'
                    },
                    previewColor: '#0081C9'
                },
                {
                    id: 'forest',
                    name: 'Forest',
                    colors: {
                        '--brand': '#059669',
                        '--site-bg': '#ecfdf5',
                        '--btn-bg': '#059669',
                        '--header-bg': '#f0fdf4'
                    },
                    previewColor: '#059669'
                },
                {
                    id: 'sunset',
                    name: 'Sunset',
                    colors: {
                        '--brand': '#ea580c',
                        '--site-bg': '#fff7ed',
                        '--btn-bg': '#ea580c',
                        '--header-bg': '#fffaf0'
                    },
                    previewColor: '#ea580c'
                },
                {
                    id: 'berry',
                    name: 'Berry',
                    colors: {
                        '--brand': '#db2777',
                        '--site-bg': '#fdf2f8',
                        '--btn-bg': '#db2777',
                        '--header-bg': '#fff1f2'
                    },
                    previewColor: '#db2777'
                },
                {
                    id: 'midnight',
                    name: 'Midnight',
                    colors: {
                        '--brand': '#1e293b',
                        '--site-bg': '#f1f5f9',
                        '--btn-bg': '#0f172a',
                        '--header-bg': '#e2e8f0'
                    },
                    previewColor: '#1e293b'
                },
                {
                    id: 'rose',
                    name: 'Rose Red',
                    colors: {
                        '--brand': '#e11d48',
                        '--site-bg': '#fff1f2',
                        '--btn-bg': '#e11d48',
                        '--header-bg': '#ffe4e6'
                    },
                    previewColor: '#e11d48'
                },
                {
                    id: 'lavender',
                    name: 'Lavender',
                    colors: {
                        '--brand': '#7c3aed',
                        '--site-bg': '#f5f3ff',
                        '--btn-bg': '#7c3aed',
                        '--header-bg': '#ede9fe'
                    },
                    previewColor: '#7c3aed'
                },
                {
                    id: 'teal',
                    name: 'Teal',
                    colors: {
                        '--brand': '#0d9488',
                        '--site-bg': '#f0fdfa',
                        '--btn-bg': '#0d9488',
                        '--header-bg': '#ccfbf1'
                    },
                    previewColor: '#0d9488'
                },
                {
                    id: 'gold',
                    name: 'Gold',
                    colors: {
                        '--brand': '#d97706',
                        '--site-bg': '#fffbeb',
                        '--btn-bg': '#d97706',
                        '--header-bg': '#fef3c7'
                    },
                    previewColor: '#d97706'
                },
                {
                    id: 'coffee',
                    name: 'Coffee',
                    colors: {
                        '--brand': '#78350f',
                        '--site-bg': '#fff7ed',
                        '--btn-bg': '#78350f',
                        '--header-bg': '#ffedd5'
                    },
                    previewColor: '#78350f'
                },
                {
                    id: 'slate',
                    name: 'Slate',
                    colors: {
                        '--brand': '#475569',
                        '--site-bg': '#f8fafc',
                        '--btn-bg': '#475569',
                        '--header-bg': '#e2e8f0'
                    },
                    previewColor: '#475569'
                },
                {
                    id: 'mint',
                    name: 'Mint',
                    colors: {
                        '--brand': '#10b981',
                        '--site-bg': '#ecfdf5',
                        '--btn-bg': '#10b981',
                        '--header-bg': '#d1fae5'
                    },
                    previewColor: '#10b981'
                },
                {
                    id: 'sky',
                    name: 'Sky Blue',
                    colors: {
                        '--brand': '#0284c7',
                        '--site-bg': '#f0f9ff',
                        '--btn-bg': '#0284c7',
                        '--header-bg': '#e0f2fe'
                    },
                    previewColor: '#0284c7'
                },
                {
                    id: 'indigo',
                    name: 'Indigo',
                    colors: {
                        '--brand': '#4f46e5',
                        '--site-bg': '#eef2ff',
                        '--btn-bg': '#4f46e5',
                        '--header-bg': '#e0e7ff'
                    },
                    previewColor: '#4f46e5'
                },
                {
                    id: 'lime',
                    name: 'Lime',
                    colors: {
                        '--brand': '#65a30d',
                        '--site-bg': '#f7fee7',
                        '--btn-bg': '#65a30d',
                        '--header-bg': '#ecfccb'
                    },
                    previewColor: '#65a30d'
                }
            ];

            const themeGrid = document.getElementById('theme-grid');
            let selectedThemeObj = null;

            // Initialize selected theme
            const savedThemeId = localStorage.getItem('planner.themeId') || 'default';
            selectedThemeObj = themes.find(t => t.id === savedThemeId) || themes[0];

            themes.forEach(theme => {
                const el = document.createElement('div');
                el.className = 'flex flex-col items-center gap-3 group';

                const circle = document.createElement('div');
                circle.className = `theme-option ${theme.id === savedThemeId ? 'active' : ''}`;
                circle.dataset.id = theme.id;
                circle.style.backgroundColor = theme.previewColor;
                circle.innerHTML = `<i data-lucide="check" class="check-icon w-6 h-6"></i>`;

                circle.onclick = () => selectTheme(theme, circle);

                const label = document.createElement('span');
                label.className = 'text-xs font-bold text-slate-500 group-hover:text-indigo-600 transition-colors uppercase tracking-tight';
                label.textContent = theme.name;

                el.appendChild(circle);
                el.appendChild(label);
                themeGrid.appendChild(el);
            });

            lucide.createIcons();

            function selectTheme(theme, circleEl) {
                selectedThemeObj = theme;

                // Update UI
                document.querySelectorAll('.theme-option').forEach(c => c.classList.remove('active'));
                circleEl.classList.add('active');

                // PREVIEW ONLY
                const root = document.documentElement;
                Object.keys(theme.colors).forEach(key => {
                    root.style.setProperty(key, theme.colors[key]);
                });
            }

            const saveBtn = document.getElementById('save-theme-btn');
            saveBtn.addEventListener('click', async () => {
                if (selectedThemeObj) {
                    const themeColors = selectedThemeObj.colors;
                    const themeId = selectedThemeObj.id;

                    localStorage.setItem('planner.theme', JSON.stringify(themeColors));
                    localStorage.setItem('planner.themeId', themeId);

                    try {
                        await fetch('/api/user/theme', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ themeId, themeColors })
                        });
                    } catch (e) { console.error('Failed to sync theme:', e); }

                    window.location.href = 'app.html';
                }
            });
        });
    </script>
</body>

</html>