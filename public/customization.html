<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Customization â€” PlannIt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="./css/styles.css?v=role1">
    <script src="/js/auth-helper.js"></script>
    <style>
        /* Theme Preview Circles */
        .theme-option {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            border: 4px solid transparent;
        }

        .theme-option:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .theme-option.active {
            border-color: #232323;
            transform: scale(1.1);
        }

        .check-icon {
            color: white;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .theme-option.active .check-icon {
            opacity: 1;
        }
    </style>
    <script>
        // APPLY THEME IMMEDIATELY
        (function () {
            const savedTheme = localStorage.getItem('planner.theme');
            if (savedTheme) {
                const theme = JSON.parse(savedTheme);
                const root = document.documentElement;
                Object.keys(theme).forEach(key => {
                    root.style.setProperty(key, theme[key]);
                });
            }
        })();
    </script>
</head>

<body class="bg-gray-50 min-h-screen">

    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-3xl mx-auto px-4 py-4 flex items-center">
        </div>
    </header>

    <main class="max-w-3xl mx-auto px-4 py-8">
        <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <div class="text-center mb-10">
                <h2 class="text-2xl font-bold text-gray-900">Choose your theme</h2>
                <p class="text-gray-500 mt-2">Personalize your PlannIt experience with a color scheme that suits you.
                </p>
            </div>

            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-8 justify-items-center" id="theme-grid">
                <!-- Generated by JS -->
            </div>

            <div class="mt-12 p-6 bg-gray-50 rounded-xl border border-gray-100">
                <div class="flex gap-4">
                    <button id="save-theme-btn" class="btn btn-primary">Choose</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            const themes = [
                {
                    id: 'default',
                    name: 'Default Purple',
                    colors: {
                        '--brand': '#845ec2',
                        '--site-bg': '#AFC1D6',
                        '--btn-bg': '#845ec2',
                        '--header-bg': '#e0f4fd'
                    },
                    previewColor: '#845ec2'
                },
                {
                    id: 'ocean',
                    name: 'Ocean Blue',
                    colors: {
                        '--brand': '#0081C9',
                        '--site-bg': '#e0f2fe',
                        '--btn-bg': '#0081C9',
                        '--header-bg': '#f0f9ff'
                    },
                    previewColor: '#0081C9'
                },
                {
                    id: 'forest',
                    name: 'Forest Green',
                    colors: {
                        '--brand': '#059669',
                        '--site-bg': '#ecfdf5',
                        '--btn-bg': '#059669',
                        '--header-bg': '#f0fdf4'
                    },
                    previewColor: '#059669'
                },
                {
                    id: 'sunset',
                    name: 'Sunset Orange',
                    colors: {
                        '--brand': '#ea580c',
                        '--site-bg': '#fff7ed',
                        '--btn-bg': '#ea580c',
                        '--header-bg': '#fffaf0'
                    },
                    previewColor: '#ea580c'
                },
                {
                    id: 'berry',
                    name: 'Berry Pink',
                    colors: {
                        '--brand': '#db2777',
                        '--site-bg': '#fdf2f8',
                        '--btn-bg': '#db2777',
                        '--header-bg': '#fff1f2'
                    },
                    previewColor: '#db2777'
                },
                {
                    id: 'midnight',
                    name: 'Midnight',
                    colors: {
                        '--brand': '#1e293b',
                        '--site-bg': '#f1f5f9',
                        '--btn-bg': '#0f172a',
                        '--header-bg': '#e2e8f0'
                    },
                    previewColor: '#1e293b'
                },
                {
                    id: 'rose',
                    name: 'Rose Red',
                    colors: {
                        '--brand': '#e11d48',
                        '--site-bg': '#fff1f2',
                        '--btn-bg': '#e11d48',
                        '--header-bg': '#ffe4e6'
                    },
                    previewColor: '#e11d48'
                },
                {
                    id: 'lavender',
                    name: 'Lavender',
                    colors: {
                        '--brand': '#7c3aed',
                        '--site-bg': '#f5f3ff',
                        '--btn-bg': '#7c3aed',
                        '--header-bg': '#ede9fe'
                    },
                    previewColor: '#7c3aed'
                },
                {
                    id: 'teal',
                    name: 'Teal',
                    colors: {
                        '--brand': '#0d9488',
                        '--site-bg': '#f0fdfa',
                        '--btn-bg': '#0d9488',
                        '--header-bg': '#ccfbf1'
                    },
                    previewColor: '#0d9488'
                },
                {
                    id: 'gold',
                    name: 'Gold',
                    colors: {
                        '--brand': '#d97706',
                        '--site-bg': '#fffbeb',
                        '--btn-bg': '#d97706',
                        '--header-bg': '#fef3c7'
                    },
                    previewColor: '#d97706'
                },
                {
                    id: 'coffee',
                    name: 'Coffee',
                    colors: {
                        '--brand': '#78350f',
                        '--site-bg': '#fff7ed',
                        '--btn-bg': '#78350f',
                        '--header-bg': '#ffedd5'
                    },
                    previewColor: '#78350f'
                },
                {
                    id: 'slate',
                    name: 'Slate',
                    colors: {
                        '--brand': '#475569',
                        '--site-bg': '#f8fafc',
                        '--btn-bg': '#475569',
                        '--header-bg': '#e2e8f0'
                    },
                    previewColor: '#475569'
                },
                {
                    id: 'mint',
                    name: 'Mint',
                    colors: {
                        '--brand': '#10b981',
                        '--site-bg': '#ecfdf5',
                        '--btn-bg': '#10b981',
                        '--header-bg': '#d1fae5'
                    },
                    previewColor: '#10b981'
                },
                {
                    id: 'sky',
                    name: 'Sky Blue',
                    colors: {
                        '--brand': '#0284c7',
                        '--site-bg': '#f0f9ff',
                        '--btn-bg': '#0284c7',
                        '--header-bg': '#e0f2fe'
                    },
                    previewColor: '#0284c7'
                },
                {
                    id: 'indigo',
                    name: 'Indigo',
                    colors: {
                        '--brand': '#4f46e5',
                        '--site-bg': '#eef2ff',
                        '--btn-bg': '#4f46e5',
                        '--header-bg': '#e0e7ff'
                    },
                    previewColor: '#4f46e5'
                },
                {
                    id: 'lime',
                    name: 'Lime',
                    colors: {
                        '--brand': '#65a30d',
                        '--site-bg': '#f7fee7',
                        '--btn-bg': '#65a30d',
                        '--header-bg': '#ecfccb'
                    },
                    previewColor: '#65a30d'
                }
            ];

            const themeGrid = document.getElementById('theme-grid');
            let selectedThemeObj = null;

            // Initialize selected theme
            const savedThemeId = localStorage.getItem('planner.themeId') || 'default';
            selectedThemeObj = themes.find(t => t.id === savedThemeId) || themes[0];

            themes.forEach(theme => {
                const el = document.createElement('div');
                el.className = 'flex flex-col items-center gap-2';

                const circle = document.createElement('div');
                circle.className = `theme-option ${theme.id === savedThemeId ? 'active' : ''}`;
                circle.dataset.id = theme.id;
                circle.style.backgroundColor = theme.previewColor;
                circle.innerHTML = `<i data-lucide="check" class="check-icon w-8 h-8"></i>`;

                circle.onclick = () => selectTheme(theme, circle);

                const label = document.createElement('span');
                label.className = 'text-sm font-medium text-gray-700';
                label.textContent = theme.name;

                el.appendChild(circle);
                el.appendChild(label);
                themeGrid.appendChild(el);
            });

            lucide.createIcons();

            function selectTheme(theme, circleEl) {
                selectedThemeObj = theme;

                // Update UI
                document.querySelectorAll('.theme-option').forEach(c => c.classList.remove('active'));
                circleEl.classList.add('active');

                // PREVIEW ONLY
                const root = document.documentElement;
                Object.keys(theme.colors).forEach(key => {
                    root.style.setProperty(key, theme.colors[key]);
                });
            }

            const saveBtn = document.getElementById('save-theme-btn');
            saveBtn.addEventListener('click', async () => {
                if (selectedThemeObj) {
                    const themeColors = selectedThemeObj.colors;
                    const themeId = selectedThemeObj.id;

                    // Save to local
                    localStorage.setItem('planner.theme', JSON.stringify(themeColors));
                    localStorage.setItem('planner.themeId', themeId);

                    // Save to server (if logged in)
                    try {
                        await fetch('/api/user/theme', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ themeId, themeColors })
                        });
                    } catch (e) { console.error('Failed to sync theme:', e); }

                    window.location.href = 'app.html';
                }
            });
        });
    </script>
</body>

</html>